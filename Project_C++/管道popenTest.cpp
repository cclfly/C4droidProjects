#include <stdio.h>
#include <unistd.h>
#include <string>

int main()
{
	FILE *fd1 = popen("ls -la","r");
	FILE *fd2 = popen("grep z","w");
	
	char buf[256]={};
	std::string tmp;
	do {
		//printf("%s",buf);
	    //fwrite(buf,1,255,fd2);
	    memset(buf,0,255);
	    fread(buf,1,255,fd1);
	    tmp += buf;
	} while (*buf);
	printf("%s",tmp.c_str());
	//fwrite(tmp.c_str(),1,tmp.length(),fd2);
	usleep(100000);
	printf("|\n|\n|\n");
	pclose(fd1);
	sleep(3);
	pclose(fd2);
	
	return 0;
}